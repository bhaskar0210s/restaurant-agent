# Restaurant Squad - Complete Agent Flow Documentation ğŸ½ï¸

This document provides an exhaustive, step-by-step breakdown of how the Restaurant Squad multi-agent system operates from customer arrival to departure.

---

## Table of Contents

1. [System Architecture Overview](#system-architecture-overview)
2. [Agent Hierarchy & Relationships](#agent-hierarchy--relationships)
3. [Backend Tools Reference](#backend-tools-reference)
4. [Complete Flow Diagrams](#complete-flow-diagrams)
5. [Phase 1: Customer Arrival (Captain Agent)](#phase-1-customer-arrival-captain-agent)
6. [Phase 2: Service & Ordering (Waiter Agent)](#phase-2-service--ordering-waiter-agent)
7. [Phase 3: Kitchen Operations (Chef Agent)](#phase-3-kitchen-operations-chef-agent)
8. [Phase 4: Food Delivery (Server Agent)](#phase-4-food-delivery-server-agent)
9. [Phase 5: Billing (Cashier Agent)](#phase-5-billing-cashier-agent)
10. [Phase 6: Payment & Departure (Waiter Agent)](#phase-6-payment--departure-waiter-agent)
11. [Alternative Flows](#alternative-flows)
12. [Callback Enforcement Mechanisms](#callback-enforcement-mechanisms)
13. [State Management](#state-management)

---

## System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          RESTAURANT SQUAD SYSTEM                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                         USER INTERFACE                               â”‚   â”‚
â”‚   â”‚              (CLI / ADK Web UI / Voice Interface)                    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚                                         â”‚
â”‚                                   â–¼                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                      AGENT ORCHESTRATION LAYER                       â”‚   â”‚
â”‚   â”‚                     (Google ADK Framework)                           â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚   â”‚  â”‚                                                                 â”‚â”‚   â”‚
â”‚   â”‚  â”‚   CAPTAIN â”€â”€â”€â”€â”€â”€â–º WAITER â”€â”€â”€â”€â”€â”€â–º CHEF â”€â”€â”€â”€â”€â”€â–º SERVER           â”‚â”‚   â”‚
â”‚   â”‚  â”‚   (Root)           â”‚              â”‚              â”‚             â”‚â”‚   â”‚
â”‚   â”‚  â”‚                    â”‚              â”‚              â”‚             â”‚â”‚   â”‚
â”‚   â”‚  â”‚                    â–¼              â”‚              â–¼             â”‚â”‚   â”‚
â”‚   â”‚  â”‚                 CASHIER â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         back to WAITER     â”‚â”‚   â”‚
â”‚   â”‚  â”‚                                                                 â”‚â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚                                         â”‚
â”‚                                   â–¼                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    MCP TOOLSET (HTTP Connection)                     â”‚   â”‚
â”‚   â”‚                  StreamableHTTPConnectionParams                      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚                                         â”‚
â”‚                                   â–¼                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    FASTMCP BACKEND SERVER                            â”‚   â”‚
â”‚   â”‚                    (JSON-RPC 2.0 over HTTP)                          â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚   â”‚  â”‚                    DATA LAYER (JSON Files)                      â”‚â”‚   â”‚
â”‚   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚   â”‚
â”‚   â”‚  â”‚  â”‚customers â”‚reserva-  â”‚ tables â”‚  menu  â”‚ orders â”‚ bills  â”‚   â”‚â”‚   â”‚
â”‚   â”‚  â”‚  â”‚  .json   â”‚tions.jsonâ”‚  .json â”‚  .json â”‚  .json â”‚  .json â”‚   â”‚â”‚   â”‚
â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Agent Hierarchy & Relationships

```mermaid
graph TB
    subgraph "Agent Hierarchy"
        Captain["ğŸ© CAPTAIN<br/>(Root Agent)"]
        Waiter["ğŸ§‘â€ğŸ³ WAITER<br/>(Service Hub)"]
        Chef["ğŸ‘¨â€ğŸ³ CHEF<br/>(Kitchen)"]
        Server["ğŸ½ï¸ SERVER<br/>(Delivery)"]
        Cashier["ğŸ’° CASHIER<br/>(Payments)"]
    end

    Captain -->|"transfer_to_agent"| Waiter
    Waiter -->|"transfer_to_agent"| Chef
    Waiter -->|"transfer_to_agent"| Cashier
    Chef -->|"transfer_to_agent"| Server
    Server -->|"transfer_to_agent"| Waiter
    Cashier -->|"transfer_to_agent"| Waiter

    subgraph "Legend"
        L1["â†’ Agent Transfer Direction"]
    end
```

### Agent Responsibilities

| Agent       | Role               | Sub-Agents    | Talks to Customer?    |
| ----------- | ------------------ | ------------- | --------------------- |
| **Captain** | Host/Orchestrator  | Waiter        | âœ… Yes                |
| **Waiter**  | Service Hub        | Chef, Cashier | âœ… Yes                |
| **Chef**    | Kitchen Operations | Server        | âŒ No (behind scenes) |
| **Server**  | Food Delivery      | None          | âš ï¸ Minimal            |
| **Cashier** | Bill Generation    | None          | âŒ No (behind scenes) |

---

## Backend Tools Reference

### 14 Available Database Operations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BACKEND TOOLS (MCP)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  CUSTOMER MGMT      â”‚  â”‚  RESERVATION MGMT   â”‚  â”‚   TABLE MGMT     â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚  â”‚  â€¢ get_customer     â”‚  â”‚  â€¢ get_reservations â”‚  â”‚  â€¢ check_table_  â”‚ â”‚
â”‚  â”‚    (find/create)    â”‚  â”‚  â€¢ create_          â”‚  â”‚    availability  â”‚ â”‚
â”‚  â”‚                     â”‚  â”‚    reservation      â”‚  â”‚  â€¢ assign_table  â”‚ â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚  â”‚  â€¢ release_table â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    MENU MGMT        â”‚  â”‚    ORDER MGMT       â”‚  â”‚  PAYMENT MGMT    â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚  â”‚  â€¢ get_menu         â”‚  â”‚  â€¢ get_customer_    â”‚  â”‚  â€¢ generate_bill â”‚ â”‚
â”‚  â”‚    (with category   â”‚  â”‚    orders           â”‚  â”‚  â€¢ process_      â”‚ â”‚
â”‚  â”‚     filter)         â”‚  â”‚  â€¢ create_order     â”‚  â”‚    payment       â”‚ â”‚
â”‚  â”‚                     â”‚  â”‚  â€¢ get_order_status â”‚  â”‚  â€¢ add_to_tab    â”‚ â”‚
â”‚  â”‚                     â”‚  â”‚  â€¢ update_order_    â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚                     â”‚  â”‚    status           â”‚  â”‚                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Complete Flow Diagrams

### Master Flow - The Complete Customer Journey

```mermaid
flowchart TD
    subgraph ARRIVAL["Phase 1: ARRIVAL (Captain)"]
        A1[Customer Arrives] --> A2[Captain Greets]
        A2 --> A3["Ask name & phone"]
        A3 --> A4["get_customer()"]
        A4 --> A5{"Customer<br/>exists?"}
        A5 -->|No| A6["Create new customer"]
        A5 -->|Yes| A7["Customer found"]
        A6 --> A7
        A7 --> A8["get_reservations()"]
        A8 --> A9{"Reservation<br/>exists?"}
        A9 -->|Yes| A10["Inform customer<br/>about reservation"]
        A9 -->|No| A11{"Want to make<br/>reservation?"}
        A11 -->|Yes| A12["create_reservation()"]
        A12 --> END1["Thank you, goodbye<br/>(FLOW ENDS)"]
        A11 -->|No| A10
        A10 --> A13["check_table_availability()"]
        A13 --> A14{"Table<br/>available?"}
        A14 -->|Yes| A15["assign_table()"]
        A14 -->|No| A16{"Customer<br/>wants to wait?"}
        A16 -->|Yes| A17["Wait â†’ release_table()"]
        A17 --> A13
        A16 -->|No| END2["Sorry, come again<br/>(FLOW ENDS)"]
        A15 --> A18["Guide to table"]
        A18 --> A19["transfer_to_agent(waiter)"]
    end

    subgraph SERVICE["Phase 2: SERVICE (Waiter)"]
        A19 --> B1["get_customer_orders()"]
        B1 --> B2["get_menu()"]
        B2 --> B3["Greet with personalization"]
        B3 --> B4["Present menu"]
        B4 --> B5["Take order"]
        B5 --> B6{"Anything else?"}
        B6 -->|Yes| B5
        B6 -->|No| B7["create_order()"]
        B7 --> B8["transfer_to_agent(chef)"]
    end

    subgraph KITCHEN["Phase 3: KITCHEN (Chef)"]
        B8 --> C1["Receive order"]
        C1 --> C2["update_order_status(ready)"]
        C2 --> C3["transfer_to_agent(server)"]
    end

    subgraph DELIVERY["Phase 4: DELIVERY (Server)"]
        C3 --> D1["Receive ready order"]
        D1 --> D2["update_order_status(served)"]
        D2 --> D3["Deliver to customer"]
        D3 --> D4["transfer_to_agent(waiter)"]
    end

    subgraph POST_MEAL["Phase 5+6: POST-MEAL (Waiter)"]
        D4 --> E1["Tell customer: call if needed"]
        E1 --> E2{"Customer<br/>request?"}
        E2 -->|More food| B5
        E2 -->|Bill please| E3["transfer_to_agent(cashier)"]
        E3 --> E4["generate_bill()"]
        E4 --> E5["transfer_to_agent(waiter)"]
        E5 --> E6["Present bill"]
        E6 --> E7["Ask payment method"]
        E7 --> E8["process_payment()"]
        E8 --> E9["release_table()"]
        E9 --> E10["Thank you, goodbye"]
    end

    style ARRIVAL fill:#e1f5fe
    style SERVICE fill:#f3e5f5
    style KITCHEN fill:#fff3e0
    style DELIVERY fill:#e8f5e9
    style POST_MEAL fill:#fce4ec
```

---

## Phase 1: Customer Arrival (Captain Agent)

The Captain Agent is the **root agent** and first point of contact.

### Detailed Step-by-Step Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CAPTAIN AGENT - ARRIVAL WORKFLOW                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 1: GREETING                                                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                          â”‚
â”‚  User: "Hi" / "Hello" / walks in                                           â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  Captain: "Hello! Welcome to our restaurant. Can I get your name           â”‚
â”‚            and phone number?"                                              â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 2: CUSTOMER IDENTIFICATION                                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                            â”‚
â”‚  User: "My name is John, phone 555-1234"                                   â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TOOL CALL: get_customer(name="John", phone="555-1234")               â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Response (if found):                                                 â”‚  â”‚
â”‚  â”‚   {"status": "found", "customer": {"id": "abc123", "name": "John"}}  â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Response (if new):                                                   â”‚  â”‚
â”‚  â”‚   {"status": "created", "customer": {"id": "xyz789", "name": "John"}}â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 3: RESERVATION CHECK (AUTOMATIC - NEVER ASK CUSTOMER)                â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•               â”‚
â”‚  âš ï¸  CRITICAL: Captain MUST check automatically, not ask customer          â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TOOL CALL: get_reservations(customer_id="abc123")                    â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Response (if exists):                                                â”‚  â”‚
â”‚  â”‚   {"status": "success", "reservations": [                            â”‚  â”‚
â”‚  â”‚     {"id": "res01", "date": "2025-12-01", "time": "19:00",           â”‚  â”‚
â”‚  â”‚      "party_size": 4, "status": "confirmed"}                         â”‚  â”‚
â”‚  â”‚   ]}                                                                 â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Response (if none):                                                  â”‚  â”‚
â”‚  â”‚   {"status": "success", "reservations": []}                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚                    â”‚                                                       â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚          â”‚                 â”‚                                               â”‚
â”‚          â–¼                 â–¼                                               â”‚
â”‚   [RESERVATION FOUND]  [NO RESERVATION]                                    â”‚
â”‚          â”‚                 â”‚                                               â”‚
â”‚          â”‚                 â–¼                                               â”‚
â”‚          â”‚    Captain: "Would you like to make a reservation,              â”‚
â”‚          â”‚              or proceed directly to a table?"                   â”‚
â”‚          â”‚                 â”‚                                               â”‚
â”‚          â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚          â”‚       â”‚                 â”‚                                       â”‚
â”‚          â”‚       â–¼                 â–¼                                       â”‚
â”‚          â”‚  [WANTS RESERVATION] [PROCEED DIRECTLY]                         â”‚
â”‚          â”‚       â”‚                 â”‚                                       â”‚
â”‚          â”‚       â–¼                 â”‚                                       â”‚
â”‚          â”‚  create_reservation()   â”‚                                       â”‚
â”‚          â”‚       â”‚                 â”‚                                       â”‚
â”‚          â”‚       â–¼                 â”‚                                       â”‚
â”‚          â”‚  "Thank you! Your       â”‚                                       â”‚
â”‚          â”‚   reservation is        â”‚                                       â”‚
â”‚          â”‚   confirmed. Goodbye!"  â”‚                                       â”‚
â”‚          â”‚       â”‚                 â”‚                                       â”‚
â”‚          â”‚       â–¼                 â”‚                                       â”‚
â”‚          â”‚  [FLOW ENDS]            â”‚                                       â”‚
â”‚          â”‚                         â”‚                                       â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                   â”‚                                                        â”‚
â”‚                   â–¼                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 4: TABLE AVAILABILITY CHECK                                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                          â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  Captain: "I found your reservation for 7:00 PM for 4 people."             â”‚
â”‚           (if reservation exists)                                          â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TOOL CALL: check_table_availability(party_size=4)                    â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Response (if available):                                             â”‚  â”‚
â”‚  â”‚   {"status": "success", "available_tables": [                        â”‚  â”‚
â”‚  â”‚     {"id": "table05", "capacity": 4, "status": "available"}          â”‚  â”‚
â”‚  â”‚   ], "count": 1}                                                     â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Response (if none):                                                  â”‚  â”‚
â”‚  â”‚   {"status": "success", "available_tables": [], "count": 0}          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚                    â”‚                                                       â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚          â”‚                 â”‚                                               â”‚
â”‚          â–¼                 â–¼                                               â”‚
â”‚    [TABLES AVAILABLE] [NO TABLES]                                          â”‚
â”‚          â”‚                 â”‚                                               â”‚
â”‚          â”‚                 â–¼                                               â”‚
â”‚          â”‚    Captain: "Unfortunately no tables are available.             â”‚
â”‚          â”‚              Would you like to wait?"                           â”‚
â”‚          â”‚                 â”‚                                               â”‚
â”‚          â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚          â”‚       â”‚                 â”‚                                       â”‚
â”‚          â”‚       â–¼                 â–¼                                       â”‚
â”‚          â”‚  [WILL WAIT]      [WON'T WAIT]                                  â”‚
â”‚          â”‚       â”‚                 â”‚                                       â”‚
â”‚          â”‚       â–¼                 â–¼                                       â”‚
â”‚          â”‚  release_table()   "Sorry, please                               â”‚
â”‚          â”‚       â”‚             come again later"                           â”‚
â”‚          â”‚       â”‚                 â”‚                                       â”‚
â”‚          â”‚       â–¼                 â–¼                                       â”‚
â”‚          â”‚  check_table_       [FLOW ENDS]                                 â”‚
â”‚          â”‚  availability()                                                 â”‚
â”‚          â”‚       â”‚                                                         â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”¤                                                         â”‚
â”‚                  â”‚                                                         â”‚
â”‚                  â–¼                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 5: TABLE ASSIGNMENT                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                   â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TOOL CALL: assign_table(customer_id="abc123", table_id="table05")    â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Response:                                                            â”‚  â”‚
â”‚  â”‚   {"status": "success", "table": {                                   â”‚  â”‚
â”‚  â”‚     "id": "table05", "status": "occupied",                           â”‚  â”‚
â”‚  â”‚     "customer_id": "abc123", "seated_at": "2025-12-01T19:00:00"      â”‚  â”‚
â”‚  â”‚   }}                                                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 6: GUIDE TO TABLE & TRANSFER                                         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                           â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  Captain: "Please follow me to table 5."                                   â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  User: "Thank you!"                                                        â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FUNCTION CALL: transfer_to_agent(agent_name="waiter_agent")          â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Transfer Message: "Customer John (ID: abc123) has been seated at     â”‚  â”‚
â”‚  â”‚                    table05. Please assist them with the menu."       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚            [WAITER AGENT TAKES OVER]                                       â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Captain Workflow Enforcement (Callback)

The system uses `enforce_captain_workflow` callback to ensure the correct sequence:

```python
CAPTAIN_WORKFLOW_TOOLS = [
    "get_customer",           # Step 1
    "get_reservations",       # Step 2 (MUST follow Step 1)
    "check_table_availability", # Step 3
    "assign_table",           # Step 4
    "transfer_to_agent"       # Step 5
]
```

---

## Phase 2: Service & Ordering (Waiter Agent)

The Waiter Agent is the **service hub** - the main point of contact for seated customers.

### Detailed Step-by-Step Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      WAITER AGENT - SERVICE WORKFLOW                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  âš ï¸  CRITICAL FIRST STEPS (MANDATORY BEFORE ANY INTERACTION)               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•              â”‚
â”‚                                                                            â”‚
â”‚  STEP 1: FETCH CUSTOMER ORDER HISTORY                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TOOL CALL: get_customer_orders(customer_id="abc123", limit=5)        â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Response:                                                            â”‚  â”‚
â”‚  â”‚   {"status": "success", "orders": [                                  â”‚  â”‚
â”‚  â”‚     {"items": [{"name": "Ribeye Steak", "quantity": 1}], ...},       â”‚  â”‚
â”‚  â”‚     {"items": [{"name": "Calamari", "quantity": 2}], ...}            â”‚  â”‚
â”‚  â”‚   ]}                                                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚  STEP 2: FETCH MENU                                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TOOL CALL: get_menu()                                                â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Response:                                                            â”‚  â”‚
â”‚  â”‚   {"status": "success", "items": [                                   â”‚  â”‚
â”‚  â”‚     {"name": "Ribeye Steak", "price": 45.99, "category": "mains"},   â”‚  â”‚
â”‚  â”‚     {"name": "Calamari", "price": 14.99, "category": "appetizers"},  â”‚  â”‚
â”‚  â”‚     {"name": "Fresh Lemonade", "price": 4.99, "category": "drinks"}, â”‚  â”‚
â”‚  â”‚     ...                                                              â”‚  â”‚
â”‚  â”‚   ]}                                                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 3: PERSONALIZED GREETING                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                              â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  Waiter: "Hello John! It's great to see you again. I see you've           â”‚
â”‚           enjoyed our Ribeye Steak and Calamari in the past!              â”‚
â”‚                                                                            â”‚
â”‚           Here is our menu:                                                â”‚
â”‚                                                                            â”‚
â”‚           ğŸ¤ APPETIZERS                                                    â”‚
â”‚           â€¢ Calamari - $14.99                                              â”‚
â”‚           â€¢ Bruschetta - $9.99                                             â”‚
â”‚           â€¢ Caesar Salad - $11.99                                          â”‚
â”‚                                                                            â”‚
â”‚           ğŸ¥© MAINS                                                         â”‚
â”‚           â€¢ Ribeye Steak - $45.99                                          â”‚
â”‚           â€¢ Grilled Salmon - $32.99                                        â”‚
â”‚           â€¢ Chicken Parmesan - $24.99                                      â”‚
â”‚                                                                            â”‚
â”‚           ğŸ° DESSERTS                                                      â”‚
â”‚           â€¢ Tiramisu - $8.99                                               â”‚
â”‚           â€¢ Cheesecake - $7.99                                             â”‚
â”‚                                                                            â”‚
â”‚           ğŸ¹ DRINKS                                                        â”‚
â”‚           â€¢ Fresh Lemonade - $4.99                                         â”‚
â”‚           â€¢ Iced Tea - $3.99                                               â”‚
â”‚                                                                            â”‚
â”‚           What would you like to order?"                                   â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 4: TAKING THE ORDER                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                   â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  User: "I'll have 2 Ribeye Steaks and 1 Calamari"                          â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  Waiter: "Excellent choice! Would you like anything else?"                 â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  User: "That's all for now"                                                â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TOOL CALL: create_order(                                             â”‚  â”‚
â”‚  â”‚   customer_id="abc123",                                              â”‚  â”‚
â”‚  â”‚   table_id="table05",                                                â”‚  â”‚
â”‚  â”‚   items=[                                                            â”‚  â”‚
â”‚  â”‚     {"name": "Ribeye Steak", "quantity": 2},                         â”‚  â”‚
â”‚  â”‚     {"name": "Calamari", "quantity": 1}                              â”‚  â”‚
â”‚  â”‚   ]                                                                  â”‚  â”‚
â”‚  â”‚ )                                                                    â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Response:                                                            â”‚  â”‚
â”‚  â”‚   {"status": "created", "order": {                                   â”‚  â”‚
â”‚  â”‚     "id": "ord001",                                                  â”‚  â”‚
â”‚  â”‚     "items": [                                                       â”‚  â”‚
â”‚  â”‚       {"name": "Ribeye Steak", "price": 45.99, "quantity": 2},       â”‚  â”‚
â”‚  â”‚       {"name": "Calamari", "price": 14.99, "quantity": 1}            â”‚  â”‚
â”‚  â”‚     ],                                                               â”‚  â”‚
â”‚  â”‚     "total": 106.97,                                                 â”‚  â”‚
â”‚  â”‚     "status": "pending"                                              â”‚  â”‚
â”‚  â”‚   }}                                                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 5: TRANSFER TO KITCHEN                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                               â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  Waiter: "Your order will be ready shortly!"                               â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  User: "OK"                                                                â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FUNCTION CALL: transfer_to_agent(agent_name="chef_agent")            â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Transfer Message: "Order ord001 for customer abc123 at table05:      â”‚  â”‚
â”‚  â”‚                    2x Ribeye Steak, 1x Calamari. Total: $106.97"     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚            [CHEF AGENT TAKES OVER]                                         â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Waiter Prerequisite Enforcement (Callback)

```python
REQUIRED_WAITER_TOOLS = {"get_customer_orders", "get_menu"}
```

The `enforce_waiter_prerequisites` callback ensures these are called BEFORE any customer interaction.

---

## Phase 3: Kitchen Operations (Chef Agent)

The Chef Agent works **behind the scenes** - no direct customer interaction.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CHEF AGENT - KITCHEN WORKFLOW                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 1: RECEIVE ORDER                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                     â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  Chef: (Internal) "Order received: 2x Ribeye Steak, 1x Calamari"           â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 2: UPDATE ORDER STATUS TO READY                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                      â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TOOL CALL: update_order_status(order_id="ord001", status="ready")    â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Response:                                                            â”‚  â”‚
â”‚  â”‚   {"status": "success", "order": {                                   â”‚  â”‚
â”‚  â”‚     "id": "ord001",                                                  â”‚  â”‚
â”‚  â”‚     "status": "ready",                                               â”‚  â”‚
â”‚  â”‚     "updated_at": "2025-12-01T19:15:00"                              â”‚  â”‚
â”‚  â”‚   }}                                                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 3: TRANSFER TO SERVER                                                â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                  â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  Chef: (Internal) "Dishes ready! Transferring to server for delivery."     â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FUNCTION CALL: transfer_to_agent(agent_name="server_agent")          â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Transfer Message: "Order ord001 is ready for delivery to table05:    â”‚  â”‚
â”‚  â”‚                    2x Ribeye Steak, 1x Calamari"                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚            [SERVER AGENT TAKES OVER]                                       â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 4: Food Delivery (Server Agent)

The Server Agent has **minimal customer interaction** - just delivery message.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SERVER AGENT - DELIVERY WORKFLOW                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 1: RECEIVE READY ORDER                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                               â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  Server: (Internal) "Received ready order for table05"                     â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 2: UPDATE ORDER STATUS TO SERVED                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                     â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TOOL CALL: update_order_status(order_id="ord001", status="served")   â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Response:                                                            â”‚  â”‚
â”‚  â”‚   {"status": "success", "order": {                                   â”‚  â”‚
â”‚  â”‚     "id": "ord001",                                                  â”‚  â”‚
â”‚  â”‚     "status": "served",                                              â”‚  â”‚
â”‚  â”‚     "updated_at": "2025-12-01T19:20:00"                              â”‚  â”‚
â”‚  â”‚   }}                                                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 3: DELIVER TO CUSTOMER                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                               â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  Server: "Here is your order. Hope you enjoy it!"                          â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 4: TRANSFER BACK TO WAITER                                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                           â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FUNCTION CALL: transfer_to_agent(agent_name="waiter_agent")          â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Transfer Message: "Order ord001 delivered to table05. Customer       â”‚  â”‚
â”‚  â”‚                    abc123 has been served."                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚            [WAITER AGENT TAKES OVER]                                       â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 5: Billing (Cashier Agent)

The Cashier Agent works **behind the scenes** - generates bill and returns to waiter.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CASHIER AGENT - BILLING WORKFLOW                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  âš ï¸  ONLY TRIGGERED WHEN CUSTOMER EXPLICITLY ASKS FOR BILL                 â”‚
â”‚                                                                            â”‚
â”‚  STEP 1: RECEIVE BILLING REQUEST                                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                           â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  Cashier: (Internal) "Generating bill for customer abc123"                 â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 2: GENERATE BILL                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                      â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TOOL CALL: generate_bill(customer_id="abc123")                       â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Response:                                                            â”‚  â”‚
â”‚  â”‚   {"status": "success", "bill": {                                    â”‚  â”‚
â”‚  â”‚     "id": "bill001",                                                 â”‚  â”‚
â”‚  â”‚     "customer_id": "abc123",                                         â”‚  â”‚
â”‚  â”‚     "orders": ["ord001", "ord002"],                                  â”‚  â”‚
â”‚  â”‚     "subtotal": 131.94,                                              â”‚  â”‚
â”‚  â”‚     "tax": 10.56,                     â† 8% tax                       â”‚  â”‚
â”‚  â”‚     "total": 142.50,                                                 â”‚  â”‚
â”‚  â”‚     "status": "pending"                                              â”‚  â”‚
â”‚  â”‚   }}                                                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 3: TRANSFER BACK TO WAITER WITH BILL                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                 â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FUNCTION CALL: transfer_to_agent(agent_name="waiter_agent")          â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Transfer Message: "Bill generated for customer abc123:               â”‚  â”‚
â”‚  â”‚                    Subtotal: $131.94, Tax: $10.56, Total: $142.50    â”‚  â”‚
â”‚  â”‚                    Bill ID: bill001"                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚            [WAITER AGENT TAKES OVER]                                       â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 6: Payment & Departure (Waiter Agent)

The Waiter Agent handles post-meal service and payment processing.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WAITER AGENT - PAYMENT WORKFLOW                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  [After Server delivers food and transfers back]                           â”‚
â”‚                                                                            â”‚
â”‚  STEP 1: POST-MEAL CHECK-IN                                                â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  Waiter: "If you need anything else, please call me."                      â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Customer can:                                                       â”‚   â”‚
â”‚  â”‚   â€¢ Order more food  â†’ Back to Taking Order flow                    â”‚   â”‚
â”‚  â”‚   â€¢ Ask for the bill â†’ Continue below                               â”‚   â”‚
â”‚  â”‚   â€¢ Wait/enjoy meal  â†’ Waiter waits                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  [When customer asks for bill - Waiter transfers to Cashier]               â”‚
â”‚  [Cashier generates bill and transfers back - see Phase 5]                 â”‚
â”‚                                                                            â”‚
â”‚  STEP 2: PRESENT BILL                                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                      â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  Waiter: "Here is your bill:                                               â”‚
â”‚                                                                            â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚           â”‚            RESTAURANT BILL                 â”‚                   â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
â”‚           â”‚ 2x Ribeye Steak        $91.98              â”‚                   â”‚
â”‚           â”‚ 1x Calamari            $14.99              â”‚                   â”‚
â”‚           â”‚ 5x Fresh Lemonade      $24.95              â”‚                   â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
â”‚           â”‚ Subtotal:              $131.92             â”‚                   â”‚
â”‚           â”‚ Tax (8%):              $10.55              â”‚                   â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
â”‚           â”‚ TOTAL:                 $142.47             â”‚                   â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                            â”‚
â”‚           How would you like to pay? (Cash, Card, or UPI)"                 â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 3: PROCESS PAYMENT                                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                  â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  User: "Card please"                                                       â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TOOL CALL: process_payment(bill_id="bill001", payment_method="card") â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Response:                                                            â”‚  â”‚
â”‚  â”‚   {"status": "success",                                              â”‚  â”‚
â”‚  â”‚    "message": "Payment processed successfully",                      â”‚  â”‚
â”‚  â”‚    "bill": {                                                         â”‚  â”‚
â”‚  â”‚      "id": "bill001",                                                â”‚  â”‚
â”‚  â”‚      "status": "paid",                                               â”‚  â”‚
â”‚  â”‚      "payment_method": "card",                                       â”‚  â”‚
â”‚  â”‚      "paid_at": "2025-12-01T20:30:00"                                â”‚  â”‚
â”‚  â”‚    }}                                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 4: RELEASE TABLE                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                     â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TOOL CALL: release_table(capacity=4)                                 â”‚  â”‚
â”‚  â”‚   (Note: In deployment, uses table_id directly)                      â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚ Response:                                                            â”‚  â”‚
â”‚  â”‚   {"status": "success", "table": {                                   â”‚  â”‚
â”‚  â”‚     "id": "table05",                                                 â”‚  â”‚
â”‚  â”‚     "status": "available",                                           â”‚  â”‚
â”‚  â”‚     "customer_id": null                                              â”‚  â”‚
â”‚  â”‚   }}                                                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  STEP 5: FAREWELL                                                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                          â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚  Waiter: "Thank you for dining with us! Please visit again. Have a         â”‚
â”‚           wonderful day!"                                                  â”‚
â”‚                                                                            â”‚
â”‚                    â”‚                                                       â”‚
â”‚                    â–¼                                                       â”‚
â”‚              [FLOW COMPLETE]                                               â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Alternative Flows

### Flow A: New Customer (No Existing Record)

```mermaid
flowchart TD
    A["Customer: 'Hi, I'm Sarah'"] --> B["get_customer()"]
    B --> C{"Customer<br/>found?"}
    C -->|No| D["Create new customer record"]
    D --> E["get_reservations()<br/>(returns empty)"]
    E --> F["Ask: Want reservation<br/>or table?"]
    F -->|Reservation| G["create_reservation()"]
    G --> H["'Thank you! Reservation confirmed.'"]
    H --> END["FLOW ENDS"]
    F -->|Table| I["check_table_availability()"]
    I --> J["Continue normal flow..."]
```

### Flow B: Customer Wants to Wait for Table

```mermaid
flowchart TD
    A["check_table_availability()"] --> B{"Tables<br/>available?"}
    B -->|No| C["'No tables available.<br/>Would you like to wait?'"]
    C --> D{"Customer<br/>response"}
    D -->|"Yes, I'll wait"| E["'Thank you for waiting.'"]
    E --> F["release_table(capacity)"]
    F --> G["'Great news! Table available!'"]
    G --> H["check_table_availability()"]
    H --> I["assign_table()"]
    I --> J["Continue to waiter..."]
    D -->|"No"| K["'Sorry, please come again.'"]
    K --> END["FLOW ENDS"]
```

### Flow C: Customer Orders Additional Items

```mermaid
flowchart TD
    A["Server delivers food"] --> B["transfer_to_agent(waiter)"]
    B --> C["'If you need anything, call me.'"]
    C --> D{"Customer<br/>request?"}
    D -->|"More food please"| E["'What would you like?'"]
    E --> F["Take new order"]
    F --> G["create_order()"]
    G --> H["transfer_to_agent(chef)"]
    H --> I["Chef prepares..."]
    I --> J["Server delivers..."]
    J --> C
    D -->|"Bill please"| K["transfer_to_agent(cashier)"]
    D -->|"Nothing"| C
```

### Flow D: Tab Payment (Pay Later)

```mermaid
flowchart TD
    A["'How would you like to pay?'"] --> B{"Payment<br/>method?"}
    B -->|"Put it on my tab"| C["add_to_tab(customer_id, amount)"]
    C --> D["'Added to your tab.<br/>Current balance: $XXX'"]
    D --> E["release_table()"]
    E --> F["'Thank you! See you soon.'"]
    B -->|"Cash/Card/UPI"| G["process_payment()"]
    G --> H["release_table()"]
    H --> I["'Thank you! Visit again.'"]
```

---

## Callback Enforcement Mechanisms

The system uses **two callback mechanisms** to enforce correct workflow sequences:

### 1. Captain Workflow Enforcement

```python
# File: callbacks.py

def enforce_captain_workflow(callback_context, llm_request):
    """
    Enforces that captain completes workflow in correct order:

    1. get_customer        â†’ MUST be called first
    2. get_reservations    â†’ MUST follow get_customer (automatically!)
    3. check_table_availability â†’ Next step
    4. assign_table        â†’ After tables found
    5. transfer_to_agent   â†’ Final step

    If captain tries to skip steps, callback injects instructions
    to call the next required tool.
    """
```

### 2. Waiter Prerequisites Enforcement

```python
# File: callbacks.py

REQUIRED_WAITER_TOOLS = {"get_customer_orders", "get_menu"}

def enforce_waiter_prerequisites(callback_context, llm_request):
    """
    Enforces that waiter calls required tools BEFORE
    any customer interaction:

    1. get_customer_orders â†’ For personalization
    2. get_menu            â†’ For menu presentation

    If waiter tries to greet customer without calling
    these tools first, callback injects instructions.
    """
```

### Callback Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CALLBACK ENFORCEMENT FLOW                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   Agent wants to respond                                                â”‚
â”‚          â”‚                                                              â”‚
â”‚          â–¼                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚   â”‚ before_model_callbackâ”‚                                               â”‚
â”‚   â”‚ (enforce_*_workflow) â”‚                                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚              â”‚                                                          â”‚
â”‚              â–¼                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚ Check: Have required tools been called?          â”‚                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚              â”‚                                                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚     â”‚               â”‚                                                   â”‚
â”‚     â–¼               â–¼                                                   â”‚
â”‚   [YES]          [NO]                                                   â”‚
â”‚     â”‚               â”‚                                                   â”‚
â”‚     â”‚               â–¼                                                   â”‚
â”‚     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚     â”‚    â”‚ Inject instruction into request â”‚                            â”‚
â”‚     â”‚    â”‚ "CRITICAL: Call [tool] NOW"     â”‚                            â”‚
â”‚     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚     â”‚               â”‚                                                   â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚             â”‚                                                           â”‚
â”‚             â–¼                                                           â”‚
â”‚      LLM processes request                                              â”‚
â”‚             â”‚                                                           â”‚
â”‚             â–¼                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚   â”‚  after_tool_callback â”‚                                               â”‚
â”‚   â”‚  (track_*_tools)     â”‚                                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚              â”‚                                                          â”‚
â”‚              â–¼                                                          â”‚
â”‚    Update state to record                                               â”‚
â”‚    that tool was called                                                 â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Management

### Session State Variables

```python
# Captain workflow state
state["captain_get_customer_called"] = True/False
state["captain_get_reservations_called"] = True/False
state["captain_check_table_availability_called"] = True/False
state["captain_assign_table_called"] = True/False
state["captain_transfer_to_agent_called"] = True/False

# Waiter workflow state
state["waiter_get_customer_orders_called"] = True/False
state["waiter_get_menu_called"] = True/False
```

### Data Flow Between Agents

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DATA FLOW BETWEEN AGENTS                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   CAPTAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º WAITER          â”‚
â”‚   Passes:                                                               â”‚
â”‚   â€¢ customer_id                                                         â”‚
â”‚   â€¢ table_id                                                            â”‚
â”‚   â€¢ customer_name                                                       â”‚
â”‚                                                                         â”‚
â”‚   WAITER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º CHEF            â”‚
â”‚   Passes:                                                               â”‚
â”‚   â€¢ order_id                                                            â”‚
â”‚   â€¢ items list                                                          â”‚
â”‚   â€¢ table_id                                                            â”‚
â”‚   â€¢ customer_id                                                         â”‚
â”‚                                                                         â”‚
â”‚   CHEF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º SERVER          â”‚
â”‚   Passes:                                                               â”‚
â”‚   â€¢ order_id                                                            â”‚
â”‚   â€¢ items list                                                          â”‚
â”‚   â€¢ table_id                                                            â”‚
â”‚                                                                         â”‚
â”‚   SERVER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º WAITER          â”‚
â”‚   Passes:                                                               â”‚
â”‚   â€¢ order_id                                                            â”‚
â”‚   â€¢ delivery confirmation                                               â”‚
â”‚   â€¢ customer_id                                                         â”‚
â”‚                                                                         â”‚
â”‚   WAITER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º CASHIER         â”‚
â”‚   Passes:                                                               â”‚
â”‚   â€¢ customer_id                                                         â”‚
â”‚                                                                         â”‚
â”‚   CASHIER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º WAITER          â”‚
â”‚   Passes:                                                               â”‚
â”‚   â€¢ bill_id                                                             â”‚
â”‚   â€¢ bill total                                                          â”‚
â”‚   â€¢ itemized details                                                    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Complete Happy Path - End to End

Here's the complete sequence for a returning customer with a reservation:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPLETE HAPPY PATH - TIMELINE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚ TIME    â”‚ AGENT    â”‚ ACTION                          â”‚ TOOL CALL        â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ 0:00    â”‚ USER     â”‚ "Hi"                            â”‚                  â”‚
â”‚ 0:01    â”‚ CAPTAIN  â”‚ "Welcome! Name & phone?"        â”‚                  â”‚
â”‚ 0:02    â”‚ USER     â”‚ "John, 555-1234"                â”‚                  â”‚
â”‚ 0:03    â”‚ CAPTAIN  â”‚ Look up customer                â”‚ get_customer()   â”‚
â”‚ 0:04    â”‚ CAPTAIN  â”‚ Check reservations              â”‚ get_reservations()â”‚
â”‚ 0:05    â”‚ CAPTAIN  â”‚ "Found your 7PM reservation!"   â”‚                  â”‚
â”‚ 0:06    â”‚ CAPTAIN  â”‚ Check tables                    â”‚ check_table_...()â”‚
â”‚ 0:07    â”‚ CAPTAIN  â”‚ Assign table                    â”‚ assign_table()   â”‚
â”‚ 0:08    â”‚ CAPTAIN  â”‚ "Follow me to table 5"          â”‚                  â”‚
â”‚ 0:09    â”‚ USER     â”‚ "Thank you!"                    â”‚                  â”‚
â”‚ 0:10    â”‚ CAPTAIN  â”‚ Transfer to waiter              â”‚ transfer_to_agentâ”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ 0:11    â”‚ WAITER   â”‚ Fetch order history             â”‚ get_customer_    â”‚
â”‚         â”‚          â”‚                                 â”‚ orders()         â”‚
â”‚ 0:12    â”‚ WAITER   â”‚ Fetch menu                      â”‚ get_menu()       â”‚
â”‚ 0:13    â”‚ WAITER   â”‚ "Hello John! I see you love     â”‚                  â”‚
â”‚         â”‚          â”‚  our Ribeye. Here's the menu!"  â”‚                  â”‚
â”‚ 0:14    â”‚ USER     â”‚ "2 Ribeye Steaks, 1 Calamari"   â”‚                  â”‚
â”‚ 0:15    â”‚ WAITER   â”‚ "Anything else?"                â”‚                  â”‚
â”‚ 0:16    â”‚ USER     â”‚ "That's all"                    â”‚                  â”‚
â”‚ 0:17    â”‚ WAITER   â”‚ Create order                    â”‚ create_order()   â”‚
â”‚ 0:18    â”‚ WAITER   â”‚ "Coming right up!"              â”‚                  â”‚
â”‚ 0:19    â”‚ USER     â”‚ "OK"                            â”‚                  â”‚
â”‚ 0:20    â”‚ WAITER   â”‚ Transfer to chef                â”‚ transfer_to_agentâ”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ 0:21    â”‚ CHEF     â”‚ Acknowledge order               â”‚                  â”‚
â”‚ 0:22    â”‚ CHEF     â”‚ Mark as ready                   â”‚ update_order_    â”‚
â”‚         â”‚          â”‚                                 â”‚ status()         â”‚
â”‚ 0:23    â”‚ CHEF     â”‚ Transfer to server              â”‚ transfer_to_agentâ”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ 0:24    â”‚ SERVER   â”‚ Acknowledge                     â”‚                  â”‚
â”‚ 0:25    â”‚ SERVER   â”‚ Mark as served                  â”‚ update_order_    â”‚
â”‚         â”‚          â”‚                                 â”‚ status()         â”‚
â”‚ 0:26    â”‚ SERVER   â”‚ "Here's your order. Enjoy!"     â”‚                  â”‚
â”‚ 0:27    â”‚ SERVER   â”‚ Transfer to waiter              â”‚ transfer_to_agentâ”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ 0:28    â”‚ WAITER   â”‚ "Call if you need anything!"    â”‚                  â”‚
â”‚  ...    â”‚  ...     â”‚ [Customer enjoys meal]          â”‚                  â”‚
â”‚ 0:45    â”‚ USER     â”‚ "Can I get the bill?"           â”‚                  â”‚
â”‚ 0:46    â”‚ WAITER   â”‚ Transfer to cashier             â”‚ transfer_to_agentâ”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ 0:47    â”‚ CASHIER  â”‚ Generate bill                   â”‚ generate_bill()  â”‚
â”‚ 0:48    â”‚ CASHIER  â”‚ Transfer to waiter              â”‚ transfer_to_agentâ”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ 0:49    â”‚ WAITER   â”‚ "Here's your bill: $142.50.     â”‚                  â”‚
â”‚         â”‚          â”‚  How would you like to pay?"    â”‚                  â”‚
â”‚ 0:50    â”‚ USER     â”‚ "Card"                          â”‚                  â”‚
â”‚ 0:51    â”‚ WAITER   â”‚ Process payment                 â”‚ process_payment()â”‚
â”‚ 0:52    â”‚ WAITER   â”‚ Release table                   â”‚ release_table()  â”‚
â”‚ 0:53    â”‚ WAITER   â”‚ "Thank you! Visit again!"       â”‚                  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚         â”‚          â”‚      âœ… FLOW COMPLETE           â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary: Agent Transfer Patterns

```mermaid
graph LR
    subgraph "Transfer Patterns"
        C[Captain] -->|"Once"| W[Waiter]
        W -->|"Per Order"| Ch[Chef]
        Ch -->|"Always"| S[Server]
        S -->|"Always"| W
        W -->|"For Bill"| Ca[Cashier]
        Ca -->|"Always"| W
    end

    style C fill:#4CAF50,color:white
    style W fill:#2196F3,color:white
    style Ch fill:#FF9800,color:white
    style S fill:#9C27B0,color:white
    style Ca fill:#F44336,color:white
```

### Transfer Rules

| From Agent | To Agent | Trigger                              |
| ---------- | -------- | ------------------------------------ |
| Captain    | Waiter   | Customer seated at table             |
| Waiter     | Chef     | Order created, customer acknowledged |
| Chef       | Server   | Order marked as "ready"              |
| Server     | Waiter   | Order delivered to customer          |
| Waiter     | Cashier  | Customer asks for bill               |
| Cashier    | Waiter   | Bill generated                       |

---

_Built with â¤ï¸ using Google ADK, Gemini, and FastMCP_
